---
title: "MA615 Assignment3"
author: "William Zen, Jack Carbaugh, Zara Waheed, Kosuke Sasaki"
date: "11/17/2021"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
Sys.setenv("LANGUAGE" = "EN")
Sys.setlocale("LC_ALL", "C")
knitr::opts_chunk$set(echo = TRUE)
library(dplyr)
library(tidyverse)
library(magrittr)
library(shiny)
library(maps)
library(drat)
library(hurricaneexposuredata)
library(hurricaneexposure)
library(ggplot2)
```

```{r, include = FALSE}
source("hmap.R")
source("buoy import-a.R")
```

# History and details

- Hurricane Katrina was a tropical cyclone that struck the southeastern United States in late August 2005. 
- The hurricane and its aftermath claimed more than 1,800 lives
- Ranked as the costliest natural disaster in U.S. history
- Originated as a tropical depression from the merger of a tropical wave and the remnants of Tropical Depression Ten.

# Rainfall from hurricane data
The graphs below in the shiny app show the changes in rainfall levels as Katrina approached. As you can see, when you switch through the days before and after the rainfall, there was not any rain 2 days before the landfall, and the rain began to fall gradually along the Katrina track 1 day before the landfall, and reached its maximum on that day. The next day, however, the rain disappeared again.

```{r, echo=FALSE}
# rainfall
ui_1 <- fluidPage(
  selectInput("days", "Select the rainfall day (landfall is day 0)", c(-5:5)),
  plotOutput("plot"),
)
server_1 <- function(input, output, session) {
  output$plot <- renderPlot({maprain(input$days)}, res = 96)
  }
shinyApp(ui_1, server_1)
```

# Peak Gust Map
Using data from NOAA's National Data Buoy Center, we were able to find 27 buoys with historical data around the landfall of Hurricane Katrina in Louisiana. We decided to focus on Peak Gust Speed and Wind Speed, as these had a direct connection to variables within the Hurricane Exposure package (as seen in our maps above), and are used as a measurement for the strength of a hurricane. For these maps, we choose time periods at the hurricane landfall, 2 hours before the landfall, and 5 hours before the landfall. This way, we can see the progression of the hurricane as it approaches the coast. We also did this as many of the buoys lost data during the landfall, likely due to the severity of the storm. 

Looking at the Peak Gust Map, we see that the strongest winds are near the South of Louisiana. This matches up with the Hurricane Exposure map, as the Peak Gusts were also the strongest throughout this area. Both maps also show some strong gusts in the areas next to Louisiana, and much weaker to nonexistant gusts in the surrounding areas.
```{r, echo=FALSE}
# Peak Gust Map
ui_2 <- fluidPage(
  selectInput("hours", "Select the time before the landfall (hour)", c(0, -2, -5)),
  plotOutput("plot"),
)
server_2 <- function(input, output, session) {
  output$plot <- renderPlot({worldmap(input$hours)}, res = 96)
  }

shinyApp(ui_2, server_2)
```

# Wind Speed map

The Observations for the Peak Gust Map apply to the Wind Speed Map as well. The highgest winds from the buoy data appear along the Louisiana coast, matching up with what we see in the Hurricane Exposure map. The surrounding areas don't show much higher winds than noraml, aligning with the Hurricane Exposure data.
```{r, echo=FALSE}
# Wind Speed map
ui_3 <- fluidPage(
  selectInput("hours", "Select the time before the landfall (hour)", c(0, -2, -5)),
  plotOutput("plot"),
)
server_3 <- function(input, output, session) {
  output$plot <- renderPlot({worldmap2(input$hours)}, res = 96)
  }

shinyApp(ui_3, server_3)
```


# Variogram results

We displayed the variance between the gust speeds from different buoys at the time of landing in a variogram. 

```{r, echo=FALSE, warning=FALSE}
plot(v$dist, v$gamma,  pch = 19, col = "gray",
     xlab = "distance", ylab = "semivariogram", main="Gust Speed Variogram")
lines(h, v_f(h))
abline(v = v_fit$range[2], col = "gray")
```


However, the variogram did not converge and the results were not very meaningful. Some reasons for this could be:

- We used too small a number of buoys to get the sense of a significant relationship between them.
- The buoy data is measured inconsistently
- Missing data values are shown as extremely high values instead of no data values.

